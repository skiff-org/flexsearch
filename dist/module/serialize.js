import{IndexInterface,DocumentInterface}from"./type.js";import{create_object,is_string}from"./common.js";export function exportIndexToObject(){return{reg:this.register,opt:this.optimize,map:this.map,ctx:this.ctx}}export function importIndexFromObject(a){return this.optimize=a.opt,this.register=a.reg,this.map=a.map,this.ctx=a.ctx,this}export function exportDocumentToObject(){const a={tag:this.tagIndex,reg:this.register,store:this.store,field:this.field,index:{}};return Object.entries(this.index).forEach(([b,c])=>{a.index[b]=c.export()}),a}export function importDocumentFromObject(a){this.tagIndex=a.tag,this.register=a.reg,this.store=a.store,this.field=a.field,Object.entries(a.index).forEach(([a,b])=>this.index[a].import(b))}async function lazyExport(a,b,c,d,e,f){const g=a(c,JSON.stringify(f));return g&&g.then&&(await g),await b.export(a,b,c,d,e+1)}export async function exportIndex(a,b,c,d,e){let f,g;switch(e||(e=0)){case 0:if(f="reg",this.fastupdate)for(let a in g=create_object(),this.register)g[a]=1;else g=this.register;break;case 1:f="cfg",g={doc:0,opt:this.optimize?1:0};break;case 2:f="map",g=this.map;break;case 3:f="ctx",g=this.ctx;break;default:return!0;}return await lazyExport(a,b||this,c?c+"."+f:f,d,e,g)}export function importIndex(a,b){b&&(is_string(b)&&(b=JSON.parse(b)),"cfg"===a?this.optimize=!!b.opt:"reg"===a?(this.fastupdate=!1,this.register=b):"map"===a?this.map=b:"ctx"===a?this.ctx=b:void 0)}export async function exportDocument(a,b,c,d,e){if(e||(e=0),d||(d=0),d<this.field.length){const c=this.field[d],f=this.index[c];return b=this,(await f.export(a,b,e?c.replace(":","-"):"",d,e++))||(d++,e=1,await b.export(a,b,c,d,e)),!0}else{let b,c;switch(e){case 1:b="tag",c=this.tagindex;break;case 2:b="store",c=this.store;break;default:return!0;}return await lazyExport(a,this,b,d,e,c)}}export function importDocument(a,b){if(b)switch(is_string(b)&&(b=JSON.parse(b)),a){case"tag":this.tagindex=b;break;case"reg":this.fastupdate=!1,this.register=b;for(let a,c=0;c<this.field.length;c++)a=this.index[this.field[c]],a.register=b,a.fastupdate=!1;break;case"store":this.store=b;break;default:a=a.split(".");const c=a[0];a=a[1],c&&a&&this.index[c].import(a,b);}}